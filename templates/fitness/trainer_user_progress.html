{% extends 'base.html' %}
{% load static %}

{% block title %}Progreso de {{ user_data.full_name }} - Universidad Fit{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div>
            <h1 class="card-title">Progreso de {{ user_data.full_name }}</h1>
            <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                Usuario: {{ user_data.username }} | Email: {{ user_data.email }}
            </p>
        </div>
        <div class="d-flex gap-2">
            <a href="{% url 'trainer_send_recommendation' user_data.user_id %}" class="btn btn-primary">
                ðŸ’¬ Enviar RecomendaciÃ³n
            </a>
            <a href="{% url 'trainer_dashboard' %}" class="btn btn-secondary">Volver</a>
        </div>
    </div>

    <!-- Resumen de Progreso -->
    {% if progress_summary %}
    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-value">{{ progress_summary.total_workouts }}</div>
            <div class="stat-label">Total Entrenamientos</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ progress_summary.avg_effort|floatformat:1 }}</div>
            <div class="stat-label">Esfuerzo Promedio</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ progress_summary.total_duration|floatformat:0 }}</div>
            <div class="stat-label">Minutos Totales</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ progress_summary.last_workout|date:"d/m"|default:"-" }}</div>
            <div class="stat-label">Ãšltimo Entrenamiento</div>
        </div>
    </div>
    {% endif %}

    <!-- Lista de Progreso -->
    {% if progress_list %}
    <div class="mt-4">
        <h2>Registros de Progreso</h2>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Rutina/Ejercicio</th>
                        <th>Repeticiones</th>
                        <th>DuraciÃ³n</th>
                        <th>Esfuerzo</th>
                        <th>Notas</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for progress in progress_list %}
                    <tr>
                        <td>{{ progress.date|date:"d/m/Y" }}</td>
                        <td>
                            {% if progress.routine_id %}
                                Rutina: {{ progress.routine_name|default:progress.routine_id }}
                            {% elif progress.exercise_id %}
                                Ejercicio: {{ progress.exercise_name|default:progress.exercise_id }}
                            {% else %}
                                General
                            {% endif %}
                        </td>
                        <td>{{ progress.repetitions|default:"-" }}</td>
                        <td>{{ progress.duration|default:"-" }} min</td>
                        <td>
                            <span class="badge badge-{% if progress.effort_level >= 8 %}danger{% elif progress.effort_level >= 5 %}warning{% else %}success{% endif %}">
                                {{ progress.effort_level }}/10
                            </span>
                        </td>
                        <td>{{ progress.notes|truncatewords:10|default:"-" }}</td>
                        <td>
                            <a href="{% url 'trainer_add_followup' progress.id %}" class="btn btn-outline btn-sm">
                                ðŸ’¬ Comentar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ðŸ“Š</div>
        <h3>No hay registros de progreso</h3>
        <p>Este usuario aÃºn no ha registrado ningÃºn progreso</p>
    </div>
    {% endif %}

    <!-- Recomendaciones Enviadas -->
    {% if recommendations %}
    <div class="mt-4">
        <h2>Recomendaciones Enviadas</h2>
        {% for recommendation in recommendations %}
        <div class="progress-item">
            <div class="progress-header">
                <div>
                    <h3>{{ recommendation.message }}</h3>
                    <p class="progress-date">{{ recommendation.created_at|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

