<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend-Backend Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .success {
            color: green;
            background: #d1fae5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            color: red;
            background: #fee2e2;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .result {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üèãÔ∏è Test Frontend-Backend Connection</h1>

    <div class="test-section">
        <h2>1. Get Exercises (READ)</h2>
        <button onclick="getExercises()">Get All Exercises</button>
        <div id="exercises-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Get Routines (READ)</h2>
        <button onclick="getRoutines()">Get All Routines</button>
        <div id="routines-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Create New Exercise (WRITE)</h2>
        <div>
            <input type="text" id="exercise-name" placeholder="Exercise Name" value="Test Exercise">
            <select id="exercise-type">
                <option value="cardio">Cardio</option>
                <option value="fuerza">Fuerza</option>
                <option value="movilidad">Movilidad</option>
            </select>
            <select id="exercise-difficulty">
                <option value="baja">Baja</option>
                <option value="media">Media</option>
                <option value="alta">Alta</option>
            </select>
            <input type="number" id="exercise-duration" placeholder="Duration (min)" value="15">
        </div>
        <button onclick="createExercise()">Create Exercise</button>
        <div id="create-exercise-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Create Progress Entry (WRITE)</h2>
        <div>
            <input type="text" id="progress-user-id" placeholder="User ID" value="test-user-1">
            <input type="number" id="progress-effort" placeholder="Effort Level (1-10)" value="7" min="1" max="10">
            <input type="text" id="progress-notes" placeholder="Notes" value="Completed workout successfully">
        </div>
        <button onclick="createProgress()">Create Progress Entry</button>
        <div id="create-progress-result"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/api';

        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers,
                    },
                });

                if (!response.ok) {
                    const error = await response.json().catch(() => ({ detail: 'Request failed' }));
                    throw new Error(error.detail || JSON.stringify(error));
                }

                if (response.status === 204) {
                    return null;
                }

                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        async function getExercises() {
            const resultDiv = document.getElementById('exercises-result');
            resultDiv.innerHTML = '<p>Loading...</p>';

            try {
                const exercises = await apiRequest('/fitness/exercises/');
                resultDiv.innerHTML = `
                    <div class="success">‚úì Successfully fetched ${exercises.length} exercises</div>
                    <div class="result">${JSON.stringify(exercises, null, 2)}</div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">‚úó Error: ${error.message}</div>
                `;
            }
        }

        async function getRoutines() {
            const resultDiv = document.getElementById('routines-result');
            resultDiv.innerHTML = '<p>Loading...</p>';

            try {
                const routines = await apiRequest('/fitness/routines/');
                resultDiv.innerHTML = `
                    <div class="success">‚úì Successfully fetched ${routines.length} routines</div>
                    <div class="result">${JSON.stringify(routines, null, 2)}</div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">‚úó Error: ${error.message}</div>
                `;
            }
        }

        async function createExercise() {
            const resultDiv = document.getElementById('create-exercise-result');
            resultDiv.innerHTML = '<p>Creating...</p>';

            const exerciseData = {
                name: document.getElementById('exercise-name').value,
                type: document.getElementById('exercise-type').value,
                difficulty: document.getElementById('exercise-difficulty').value,
                duration: parseInt(document.getElementById('exercise-duration').value),
                description: 'Test exercise created from frontend',
                videoUrl: 'https://example.com/test-video',
                createdBy: 'test-frontend'
            };

            try {
                const exercise = await apiRequest('/fitness/exercises/', {
                    method: 'POST',
                    body: JSON.stringify(exerciseData),
                });

                resultDiv.innerHTML = `
                    <div class="success">‚úì Successfully created exercise with ID: ${exercise.id}</div>
                    <div class="result">${JSON.stringify(exercise, null, 2)}</div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">‚úó Error: ${error.message}</div>
                `;
            }
        }

        async function createProgress() {
            const resultDiv = document.getElementById('create-progress-result');
            resultDiv.innerHTML = '<p>Creating...</p>';

            // First get an exercise to link to
            try {
                const exercises = await apiRequest('/fitness/exercises/');
                if (exercises.length === 0) {
                    throw new Error('No exercises found. Please create an exercise first.');
                }

                const progressData = {
                    userId: document.getElementById('progress-user-id').value,
                    exerciseId: exercises[0].id,
                    effortLevel: parseInt(document.getElementById('progress-effort').value),
                    notes: document.getElementById('progress-notes').value,
                    sets: 3,
                    reps: 12,
                    duration: 30
                };

                const progress = await apiRequest('/fitness/progress/', {
                    method: 'POST',
                    body: JSON.stringify(progressData),
                });

                resultDiv.innerHTML = `
                    <div class="success">‚úì Successfully created progress entry with ID: ${progress.id}</div>
                    <div class="result">${JSON.stringify(progress, null, 2)}</div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">‚úó Error: ${error.message}</div>
                `;
            }
        }

        // Auto-run tests on load
        window.onload = () => {
            console.log('Page loaded. Ready to test!');
        };
    </script>
</body>
</html>
